{% extends 'main.html' %} {% block content %}

<main class="page-wrap">
  <section class="home-panel">
    <div class="workouts-container" style="display: flex; flex-direction: column; gap: 12px; width: 100%; max-width: 700px; margin: 0 auto; padding: 0 20px;">
      <h2 style="color: var(--white); margin-bottom: 24px;">Edzésterv szerkesztése</h2>
      
      <form method="post" action="{% url 'edit_workout' workout_id %}" id="workoutForm">
        {% csrf_token %}
        
        <!-- Meglévő feladatok -->
        <div id="existing-excercises">
          {% for excercise in excercises %}
          <div style="position: relative;">
            <button onclick="showDeleteModal({{ excercise.id }})" type="button" style="position: absolute; top: 16px; right: 16px; background: rgba(220, 38, 38, 0.8); border: none; border-radius: 8px; padding: 8px 12px; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: all 0.2s; z-index: 10;" onmouseover="this.style.background='rgba(220, 38, 38, 1)'" onmouseout="this.style.background='rgba(220, 38, 38, 0.8)'">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <polyline points="3 6 5 6 21 6"></polyline>
                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                <line x1="10" y1="11" x2="10" y2="17"></line>
                <line x1="14" y1="11" x2="14" y2="17"></line>
              </svg>
            </button>
            
            <div class="card big" style="width: 100%; padding: 28px; display: flex; flex-direction: column; gap: 16px;">
              <div style="display: flex; flex-direction: column; gap: 8px;">
                <label style="color: var(--muted); font-weight: 700; font-size: 0.9rem;">Feladat neve</label>
                <input type="text" name="excercise_name_{{ excercise.id }}" value="{{ excercise.name }}" style="width: 100%; padding: 10px 14px; background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 8px; color: var(--white); font-size: 1rem;" />
              </div>
              
              <div style="display: flex; gap: 16px;">
                <div style="flex: 1; display: flex; flex-direction: column; gap: 8px;">
                  <label style="color: var(--muted); font-weight: 700; font-size: 0.9rem;">Sorozatok</label>
                  <input type="number" name="excercise_sets_{{ excercise.id }}" value="{{ excercise.sets }}" min="1" style="width: 100%; padding: 10px 14px; background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 8px; color: var(--white); font-size: 1rem; text-align: center;" />
                </div>
                
                <div style="flex: 1; display: flex; flex-direction: column; gap: 8px;">
                  <label style="color: var(--muted); font-weight: 700; font-size: 0.9rem;">Ismétlések</label>
                  <input type="number" name="excercise_reps_{{ excercise.id }}" value="{{ excercise.reps }}" min="1" style="width: 100%; padding: 10px 14px; background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 8px; color: var(--white); font-size: 1rem; text-align: center;" />
                </div>
              </div>
            </div>
          </div>
          {% empty %}
          <div style="text-align: center; padding: 40px 20px;">
            <p style="color: var(--muted); font-size: 1.1rem;">Még nincsenek feladatok az edzéstervben.</p>
          </div>
          {% endfor %}
        </div>
        
        <!-- Új feladatok (dinamikusan hozzáadva) -->
        <div id="new-excercises"></div>
        
        <div style="display: flex; gap: 12px; margin-top: 24px;">
          <button type="button" onclick="addNewExcercise()" class="card big" style="flex: 1; padding: 20px; text-align: center; border: none; background: inherit; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: all 0.2s;">
            <div style="display: flex; flex-direction: column; align-items: center; gap: 8px;">
              <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="var(--accent)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <line x1="12" y1="5" x2="12" y2="19"></line>
                <line x1="5" y1="12" x2="19" y2="12"></line>
              </svg>
              <p style="margin: 0; color: var(--white); font-weight: 600;">Új feladat hozzáadása</p>
            </div>
          </button>
        </div>
        
        <button type="submit" class="btn form-btn" style="width: 100%; margin-top: 24px; padding: 14px 24px;">
          Mentés
        </button>
      </form>
    </div>
  </section>
</main>

<!-- Delete Confirmation Modal -->
<div id="deleteModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.7); z-index: 1000; align-items: center; justify-content: center;">
  <div style="background: var(--bg-secondary); border-radius: 16px; padding: 32px; max-width: 400px; width: 90%; box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);">
    <h3 style="color: var(--white); margin: 0 0 16px 0; font-size: 1.5rem; text-align: center;">Feladat törlése</h3>
    <p style="color: var(--muted); margin: 0 0 24px 0; text-align: center; line-height: 1.5;">Biztosan törölni szeretnéd ezt a feladatot? Ez a művelet nem visszavonható.</p>
    <div style="display: flex; gap: 12px; justify-content: center;">
      <button onclick="closeDeleteModal()" style="background: var(--bg-primary); color: var(--white); border: 2px solid var(--muted); border-radius: 8px; padding: 12px 24px; cursor: pointer; font-size: 1rem; font-weight: 600; transition: all 0.2s;" onmouseover="this.style.background='var(--bg-secondary)'" onmouseout="this.style.background='var(--bg-primary)'">
        Mégse
      </button>
      <button onclick="confirmDelete()" style="background: rgba(220, 38, 38, 0.9); color: white; border: none; border-radius: 8px; padding: 12px 24px; cursor: pointer; font-size: 1rem; font-weight: 600; transition: all 0.2s;" onmouseover="this.style.background='rgba(220, 38, 38, 1)'" onmouseout="this.style.background='rgba(220, 38, 38, 0.9)'">
        Törlés
      </button>
    </div>
  </div>
</div>

<script>
let excerciseToDelete = null;
let newExcerciseCounter = 0;

function showDeleteModal(excerciseId) {
  excerciseToDelete = excerciseId;
  const modal = document.getElementById('deleteModal');
  modal.style.display = 'flex';
}

function closeDeleteModal() {
  const modal = document.getElementById('deleteModal');
  modal.style.display = 'none';
  excerciseToDelete = null;
}

function confirmDelete() {
  if (excerciseToDelete) {
    window.location.href = `/editor/delete_excercise/${excerciseToDelete}/`;
  }
}

function addNewExcercise() {
  const container = document.getElementById('new-excercises');
  const id = `new_${newExcerciseCounter}`;
  
  const newExcerciseHTML = `
    <div style="position: relative; margin-top: 12px;" data-new-id="${id}">
      <button onclick="removeNewExcercise('${id}')" type="button" style="position: absolute; top: 16px; right: 16px; background: rgba(220, 38, 38, 0.8); border: none; border-radius: 8px; padding: 8px 12px; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: all 0.2s; z-index: 10;" onmouseover="this.style.background='rgba(220, 38, 38, 1)'" onmouseout="this.style.background='rgba(220, 38, 38, 0.8)'">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <polyline points="3 6 5 6 21 6"></polyline>
          <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
          <line x1="10" y1="11" x2="10" y2="17"></line>
          <line x1="14" y1="11" x2="14" y2="17"></line>
        </svg>
      </button>
      
      <div class="card big" style="width: 100%; padding: 28px; display: flex; flex-direction: column; gap: 16px; border: 2px dashed var(--accent);">
        <div style="display: flex; flex-direction: column; gap: 8px;">
          <label style="color: var(--muted); font-weight: 700; font-size: 0.9rem;">Feladat neve</label>
          <input type="text" name="new_excercise_name_${id}" placeholder="pl. Fekvőtámasz" style="width: 100%; padding: 10px 14px; background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 8px; color: var(--white); font-size: 1rem;" />
        </div>
        
        <div style="display: flex; gap: 16px;">
          <div style="flex: 1; display: flex; flex-direction: column; gap: 8px;">
            <label style="color: var(--muted); font-weight: 700; font-size: 0.9rem;">Sorozatok</label>
            <input type="number" name="new_excercise_sets_${id}" placeholder="3" min="1" style="width: 100%; padding: 10px 14px; background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 8px; color: var(--white); font-size: 1rem; text-align: center;" />
          </div>
          
          <div style="flex: 1; display: flex; flex-direction: column; gap: 8px;">
            <label style="color: var(--muted); font-weight: 700; font-size: 0.9rem;">Ismétlések</label>
            <input type="number" name="new_excercise_reps_${id}" placeholder="10" min="1" style="width: 100%; padding: 10px 14px; background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 8px; color: var(--white); font-size: 1rem; text-align: center;" />
          </div>
        </div>
      </div>
    </div>
  `;
  
  container.insertAdjacentHTML('beforeend', newExcerciseHTML);
  newExcerciseCounter++;
}

function removeNewExcercise(id) {
  const element = document.querySelector(`[data-new-id="${id}"]`);
  if (element) {
    element.remove();
  }
}

document.getElementById('workoutForm').addEventListener('submit', function(e) {
  // A form normálisan fog submitolódni, az összes input adat el fog küldődni
});

// Kattintás a modal háttérre is bezárja
document.getElementById('deleteModal').addEventListener('click', function(e) {
  if (e.target === this) {
    closeDeleteModal();
  }
});
</script>

{% endblock %}