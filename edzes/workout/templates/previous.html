{% extends 'main.html' %} {% block content %}

<main class="page-wrap">
  <section class="home-panel">
    <div class="workouts-container" style="display: flex; flex-direction: column; gap: 12px; width: 100%; max-width: 700px; margin: 0 auto; padding: 0 20px;">
      <h2 style="color: var(--white); margin-bottom: 24px;">Előző edzések</h2>
      
      {% for workout in previous_workouts %}
      <div style="position: relative;">
        <button onclick="showDeleteModal({{ workout.id }})" type="button" style="position: absolute; top: 16px; right: 16px; background: rgba(220, 38, 38, 0.8); border: none; border-radius: 8px; padding: 8px 12px; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: all 0.2s; z-index: 10;" onmouseover="this.style.background='rgba(220, 38, 38, 1)'" onmouseout="this.style.background='rgba(220, 38, 38, 0.8)'">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <polyline points="3 6 5 6 21 6"></polyline>
            <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
            <line x1="10" y1="11" x2="10" y2="17"></line>
            <line x1="14" y1="11" x2="14" y2="17"></line>
          </svg>
        </button>
        
        <form method="post" action="{% url 'previous' %}">
          {% csrf_token %}
          <input type="hidden" name="action" value="load_workout">
          <input type="hidden" name="workout_type_id" value="{{ workout.workout.id }}">
          <input type="hidden" name="is_active" value="true">
          <input type="hidden" name="save_id" value="{{ workout.id }}">
          
          <button type="submit" class="card big" style="width: 100%; min-height: 140px; padding: 28px; text-align: center; border: none; background: inherit; cursor: pointer; display: flex; align-items: center; justify-content: center;">
            <div class="card-body" style="display: flex; flex-direction: column; align-items: center; justify-content: center; width: 100%;">
              <h3 class="card-subtitle" style="margin: 0 0 8px 0;">{{ workout.workout.name }}</h3>
              
              <div class="card-divider" style="height: 1px; background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent); margin: 12px 0; width: 100%;"></div>
              
              <div style="display: flex; gap: 24px; width: 100%; justify-content: center; flex-wrap: wrap; margin-bottom: 12px;">
                <div style="text-align: center;">
                  <p style="margin: 0; color: var(--muted); font-size: 0.9rem; font-weight: 600;">Idő</p>
                  <p style="margin: 4px 0 0 0; color: var(--accent); font-size: 1.2rem; font-weight: 900;">{{ workout.timer }} perc</p>
                </div>
                <div style="text-align: center;">
                  <p style="margin: 0; color: var(--muted); font-size: 0.9rem; font-weight: 600;">Készítő</p>
                  <p style="margin: 4px 0 0 0; color: var(--white); font-size: 1.1rem; font-weight: 700;">{{ workout.userid.username }}</p>
                </div>
              </div>

              {% if workout.comment %}
              <p style="margin: 8px 0 0 0; color: var(--muted); font-size: 0.95rem; font-style: italic; width: 100%; word-wrap: break-word;">{{ workout.comment }}</p>
              {% endif %}
            </div>
          </button>
        </form>
      </div>
      {% empty %}
      <div style="text-align: center; padding: 40px 20px;">
        <p style="color: var(--muted); font-size: 1.1rem;">Még nincsenek előző edzések.</p>
      </div>
      {% endfor %}
    </div>
  </section>
</main>

<!-- Delete Confirmation Modal -->
<div id="deleteModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.7); z-index: 1000; align-items: center; justify-content: center;">
  <div style="background: var(--bg-secondary); border-radius: 16px; padding: 32px; max-width: 400px; width: 90%; box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);">
    <h3 style="color: var(--white); margin: 0 0 16px 0; font-size: 1.5rem; text-align: center;">Edzés törlése</h3>
    <p style="color: var(--muted); margin: 0 0 24px 0; text-align: center; line-height: 1.5;">Biztosan törölni szeretnéd ezt az edzést? Ez a művelet nem visszavonható.</p>
    <div style="display: flex; gap: 12px; justify-content: center;">
      <button onclick="closeDeleteModal()" style="background: var(--bg-primary); color: var(--white); border: 2px solid var(--muted); border-radius: 8px; padding: 12px 24px; cursor: pointer; font-size: 1rem; font-weight: 600; transition: all 0.2s;" onmouseover="this.style.background='var(--bg-secondary)'" onmouseout="this.style.background='var(--bg-primary)'">
        Mégse
      </button>
      <button onclick="confirmDelete()" style="background: rgba(220, 38, 38, 0.9); color: white; border: none; border-radius: 8px; padding: 12px 24px; cursor: pointer; font-size: 1rem; font-weight: 600; transition: all 0.2s;" onmouseover="this.style.background='rgba(220, 38, 38, 1)'" onmouseout="this.style.background='rgba(220, 38, 38, 0.9)'">
        Törlés
      </button>
    </div>
  </div>
</div>

<script>
let workoutToDelete = null;

function showDeleteModal(workoutId) {
  workoutToDelete = workoutId;
  const modal = document.getElementById('deleteModal');
  modal.style.display = 'flex';
}

function closeDeleteModal() {
  const modal = document.getElementById('deleteModal');
  modal.style.display = 'none';
  workoutToDelete = null;
}

function confirmDelete() {
  if (workoutToDelete) {
    window.location.href = "{% url 'delete' 999999 %}".replace('999999', workoutToDelete);
  }
}

// Kattintás a modal háttérre is bezárja
document.getElementById('deleteModal').addEventListener('click', function(e) {
  if (e.target === this) {
    closeDeleteModal();
  }
});
</script>

{% endblock %}